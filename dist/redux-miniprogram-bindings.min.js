const t=t=>"function"==typeof t,e=Object.prototype.toString,n=t=>"[object Object]"===e.call(t),o=t=>e.call(t),s=Object.keys,{hasOwnProperty:c}=Object.prototype,a=t=>{throw new Error(t)},i=my,r=(t=!1)=>({page:["onLoad","onUnload"],component:[t?"onInit":"didMount","didUnmount"]});function u(e){n(e)||a("provider must be an Object");const{store:o,namespace:s="",component2:c=!1}=e;o&&t(o.getState)&&t(o.dispatch)&&t(o.subscribe)||a("store must be a Redux Store instance"),i.__REDUX_BINDINGS_PROVIDER__={store:o,lifetimes:r(c),namespace:s}}function f(){return i.__REDUX_BINDINGS_PROVIDER__||a("Please setup provider first"),i.__REDUX_BINDINGS_PROVIDER__}const l=()=>f().store,p=()=>f().store.getState(),h=()=>f().store.dispatch;function b(t){const{store:e}=f();let n=e.getState();return e.subscribe(()=>{const o=e.getState();t(o,n),n=o})}function g(t){const{store:e}=f(),n={};return Object.defineProperty(n,"value",{configurable:!1,enumerable:!0,get:()=>t(e.getState())}),n}function d(t,e){if(!Array.isArray(e)||e.length<1)return t;let n,o={};return function(s){return e.some(t=>o[t]!==s[t])&&(o=s,n=t(s)),n}}function m(t){const e=p(),o={};for(let s=0,a=t.length;s<a;s++){const a=t[s];switch(typeof a){case"string":c.call(e,a)&&(o[a]=e[a]);break;case"function":{const t=a(e);n(t)&&Object.assign(o,t);break}}}return o}function y(e,o){n(e)?function(e,n){const o=h(),c=s(e);for(let s=0,a=c.length;s<a;s++){const a=c[s],i=e[a];t(i)&&(n[a]=(...t)=>o(i.apply(null,t)))}}(e,o):t(e)&&function(t,e){const o=t(h());n(o)||a("The mapDispatch function must return an object"),Object.assign(e,o)}(e,o)}function j(t,e,n,c){const a=s(t),i=s(e),r=a.length,u=i.length;if(!(r<1&&u<1))if(r<1||u<1||r<u)n[c]=t;else{for(let e=0;e<u;e++){const o=i[e];if(a.indexOf(o)<0)return void(n[c]=t)}for(let s=0;s<r;s++){const r=a[s],u=t[r],f=`${c}.${r}`;if(i.indexOf(r)<0){n[f]=u;continue}const l=e[r];if(u!==l){const t=o(u);t!==o(l)?n[f]=u:"[object Object]"===t?j(u,l,n,f):"[object Array]"===t?O(u,l,n,f):n[f]=u}}}}function O(t,e,n,s){const c=t.length,a=e.length;if(!(c<1&&a<1))if(c<1||a<1||c<a)n[s]=t;else for(let i=0;i<c;i++){const c=t[i],r=`${s}[${i}]`;if(i>=a){n[r]=c;continue}const u=e[i];if(c!==u){const t=o(c);t!==o(u)?n[r]=c:"[object Object]"===t?j(c,u,n,r):"[object Array]"===t?O(c,u,n,r):n[r]=c}}}function _(t,e,n=""){const c=s(t),a=s(e),i=c.length,r=a.length;if(i<1&&r<1)return{};if(i<1||r<1)return n?{[n]:t}:t;const u={};for(let s=0;s<i;s++){const i=c[s],r=t[i],f=n?`${n}.${i}`:i;if(a.indexOf(i)<0){u[f]=r;continue}const l=e[i];if(r!==l){const t=o(r);t!==o(l)?u[f]=r:"[object Object]"===t?j(r,l,u,f):"[object Array]"===t?O(r,l,u,f):u[f]=r}}return u}const D=[];function S(){if(D.length<1)return;let t;for(;t=D.shift();){const e=_(t.updater,t.data,t.rootPath);s(e).length>0&&t.setData(e)}}function I(t,e){return b((o,c)=>{const a={};for(let t=0,s=e.length;t<s;t++){const s=e[t];switch(typeof s){case"string":o[s]!==c[s]&&(a[s]=o[s]);break;case"function":{const t=s(o);n(t)&&Object.assign(a,t);break}}}s(a).length>0&&function({id:t,data:e,setData:n},o){const s=D.find(e=>e.id===t);s?Object.assign(s.updater,o):D.push({id:t,rootPath:f().namespace,data:Object.assign({},e),updater:o,setData:n}),Object.assign(e,o),Promise.resolve().then(S)}(t,a)})}const P=Symbol("INSTANCE_ID");function R({type:t="page",mapState:e,mapDispatch:n,manual:o=!1}={}){"page"!==t&&"component"!==t&&a('The type attribute can only be "page" or "component"');const c="page"===t,{lifetimes:i,namespace:r}=f();return function(a){if(Array.isArray(e)&&e.length>0){const n=m(e);a.data=Object.assign(a.data||{},r?{[r]:n}:n);const o=new Map,[c,u]=i[t],f=a[c],l=a[u];a[c]=function(...t){const n=()=>r?this.data[r]:this.data,c=_(m(e),n(),r);s(c).length>0&&this.setData(c);const a=Symbol("instanceId"),i=I({id:a,data:n(),setData:this.setData.bind(this)},e);o.set(a,i),this[P]=a,f&&f.apply(this,t)},a[u]=function(){l&&l.apply(this);const t=this[P];if(o.has(t)){const e=o.get(t);o.delete(t),e()}}}if(n){const t=c?a:a.methods=a.methods||{};y(n,t)}return o?a:c?Page(a):Component(a)}}function A(t={}){return t.type="page",R(t)}function E(t={}){return t.type="component",R(t)}export{E as $component,A as $page,R as connect,u as setProvider,h as useDispatch,g as useRef,d as useSelector,p as useState,l as useStore,b as useSubscribe};
